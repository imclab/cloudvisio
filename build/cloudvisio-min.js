window.Cloudvisio||function(t){function o(o){o.innerRadius=0;var e=t.interpolate({startAngle:0,endAngle:0},o);return function(t){return r(e(t))}}var e={el:"#vis",layout:"stack",container:"svg",width:"100%",height:"100%",colors:t.scale.category20c(),chart:{}};Cloudvisio=function(t){t=t||{},this.el=t.el||e.el,t.layout=(t.layout||e.layout).toLowerCase(),t.container=t.container||e.container,t.width=t.width||e.width,t.height=t.height||e.height,t.colors=t.colors||e.colors,t.chart=t.chart||e.chart,this.options=t;var o=this.charts[t.layout]||this.charts.stack;this.chart(o),this._container()},Cloudvisio.prototype={constructor:Cloudvisio,description:function(){return"Cloudvisio running on D3"}},Cloudvisio.prototype.models=[],Cloudvisio.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},Cloudvisio.prototype.parse=function(t){if(t=t||!1){if("undefined"!=t.length)for(var o in t)this.models.push(t[o]);else this.models.push(t);return this}},Cloudvisio.prototype.search=function(t){return RegExp(t),this},Cloudvisio.prototype.find=function(t,o){t instanceof Array&&(t=t.join("|"));var e=RegExp(t,"gi");return o.match(e)},Cloudvisio.prototype.keys=function(t){t=t||this.data();var o=[];for(var e in t){var r=Object.keys(t[e]);for(var n in r)o.indexOf(r[n])>-1||o.push(r[n])}return o},Cloudvisio.prototype.axis=function(t){if(!arguments.length)return Object.keys(this.models[0]||{});var o=this.data();for(var e in o)this.models[e]===void 0&&(this.models[e]={}),this.models[e][t]="string"==typeof o[e][t]?o[e][t]:"object"==typeof o[e][t]?o[e][t].value||o[e][t].name||o[e][t].title||o[e][t].id||o[e][t]:null;return this},Cloudvisio.prototype.group=function(t,o){t=t.join("`").toLowerCase().split("`");for(var e in this.models){var r=this.models[e];if(r[o]!==void 0){var n=this.find(t,r[o]);if(n instanceof Array){var i=n.pop().toLowerCase();r["group_"+o]=t.indexOf(i)}else r["group_"+o]=-1}else r["group_"+o]=-1}this.options.chart["group_"+o]=t},Cloudvisio.prototype.remove=function(t){for(var o in this.models){var e=this.models[o];e[t]!==void 0&&delete this.models[o][t]}},Cloudvisio.prototype._data={},Cloudvisio.prototype.process=function(t,o){console.log(t+" : "+o)},Cloudvisio.prototype.match=function(t){return RegExp(t),this},Cloudvisio.prototype.verbalize=function(){},Cloudvisio.prototype.chart=function(t){return arguments.length?(this.charts[this.options.layout]!==void 0&&(this.options.layout="untitled"),this.charts[this.options.layout]=t,this):this.charts[this.options.layout]||null},Cloudvisio.prototype.charts={},Cloudvisio.prototype.charts.stack=function(){function o(){var t=e.options.chart.label,o=e.options.chart.value,r=e.models.map(function(o){return o[t]}),n=e.models.map(function(t,e){return{x:e,y:t[o]}});return{labels:r,values:[n]}}var e=this,r=1e3,n=1e3,i=o(),s=t.select(this.el+" "+this.options.container).append("svg:g").attr("transform","translate(30,970)");x=t.scale.ordinal().rangeRoundBands([0,r]),y=t.scale.linear().range([0,n]);var a=t.layout.stack()(i.values);x.domain(a[0].map(function(t){return t.x})),y.domain([0,t.max(a[a.length-1],function(t){return t.y0+t.y})]);var l=s.selectAll("g.valgroup").data(a).enter().append("svg:g").attr("class","valgroup").style("fill",function(t,o){return e.color(o)}).style("stroke",function(o,r){return t.rgb(e.color(r)).darker()});l.selectAll("rect").data(function(t){return t}).enter().append("svg:rect").attr("x",function(t){return x(t.x)}).attr("y",function(t){return-y(t.y0)-y(t.y)}).attr("height",function(t){return y(t.y)}).attr("width",x.rangeBand()),s.selectAll("text").data(i.labels).enter().append("svg:text").attr("x",function(t){return x(t)+x.rangeBand()/2}).attr("y",6).attr("text-anchor","middle").attr("dy",".71em").text(function(t){return t});var u=s.selectAll("g.rule").data(y.ticks(5)).enter().append("svg:g").attr("class","rule").attr("transform",function(t){return"translate(0,"+-y(t)+")"});u.append("svg:line").attr("x2",r).style("stroke",function(t){return t?"#fff":"#000"}).style("stroke-opacity",function(t){return t?.3:null}),u.append("svg:text").attr("x",-20).attr("dy",".35em").text(t.format(",d"))};var r=t.svg.arc();Cloudvisio.prototype.charts.pie=function(){function e(){var t=n.options.chart.label,o=n.options.chart.value,e=n.models.map(function(o){return o[t]}),r=n.models.map(function(t){return t[o]});return{labels:e,values:[r]}}var n=this,i=1e3,s=i/2,a=this.options.chart.ir||0,l=e(),u=t.select(this.el+" "+this.options.container).data(l.values).append("svg:g").attr("transform","translate("+s+","+s+")");u.selectAll("path").data(t.layout.pie()).enter().append("svg:path").attr("class","slice").attr("d",r.innerRadius(a).outerRadius(s)).style("fill",function(t,o){return n.color(o)}),u.selectAll("path").transition().ease("cubic").duration(2e3).attrTween("d",o)},Cloudvisio.prototype.charts.force=function(){function o(){var t,o,r=e.models,n=e.keys(r);n.indexOf("id")>-1&&(t="id"),n.indexOf("title")>-1&&(t="title"),n.indexOf("label")>-1&&(t="label"),n.indexOf("name")>-1&&(t="name");for(var i in n)0===n[i].search(/group_/gi)&&(o=n[i]);var s=[];for(var a in r)s.push({name:r[a][t],group:r[a][o]});return s}var e=this,r=t.select(this.el+" "+this.options.container),n=1e3,i=1e3,s=o(),a=t.layout.force().charge(-20).linkDistance(30).size([n,i]).nodes(s).links([]).start(),l=r.selectAll(".node").data(s).enter().append("circle").attr("class","node").attr("r",5).style("fill",function(t){return e.color(t.group)}).call(a.drag);l.append("title").text(function(t){return t.name}),a.on("tick",function(t){var o=6*t.alpha;s.forEach(function(t){t.x+=2&t.group+2?o:-o,t.y+=1&t.group+2?o:-o}),l.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})})},Cloudvisio.prototype.render=function(o){var e=this.chart();o=o||!1,o||(t.select(this.el).html(""),this._container()),null!==e&&e.call(this,arguments)},Cloudvisio.prototype.update=function(){},Cloudvisio.prototype.set=function(t){if(!(t instanceof Object))return this;for(var o in t)this.options[o]=t[o];return this},Cloudvisio.prototype._container=function(){function o(){n.attr("transform","translate("+t.event.translate+")"+" scale("+t.event.scale+")")}var e=1e3,r=1e3,n=t.select(this.el).append(this.options.container);return n.attr({width:this.options.width,height:this.options.height}).attr("viewBox","0 0 "+e+" "+r).attr("preserveAspectRatio","xMidYMid meet").attr("pointer-events","all").call(t.behavior.zoom().on("zoom",o)),n},Cloudvisio.prototype.colors=function(t){return arguments.length?(this.options.colors=t,this):this.options.colors},Cloudvisio.prototype.color=function(t){return this.options.colors instanceof Function?this.options.colors(t):this.options.colors[t]}}(window.d3);