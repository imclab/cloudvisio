window.Cloudvisio||function(t){function o(o){o.innerRadius=0;var i=t.interpolate({startAngle:0,endAngle:0},o);return function(t){return n(i(t))}}var i={el:"#vis",layout:"stack",container:"svg",width:"100%",height:"100%",colors:t.scale.category20c()};Cloudvisio=function(t){t=t||{},this.el=t.el||i.el,t.layout=(t.layout||i.layout).toLowerCase(),t.container=t.container||i.container,t.width=t.width||i.width,t.height=t.height||i.height,t.colors=t.colors||i.colors,this.options=t;var o=this.charts[t.layout]||this.charts.stack;this.chart(o),this._container()},Cloudvisio.prototype={constructor:Cloudvisio,description:function(){return"Cloudvisio running on D3"}},Cloudvisio.prototype.models=[],Cloudvisio.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},Cloudvisio.prototype.parse=function(t){if(t=t||!1){if("undefined"!=t.length)for(var o in t)this.models.push(t[o]);else this.models.push(t);return this}},Cloudvisio.prototype.search=function(t){return RegExp(t),this},Cloudvisio.prototype.find=function(t,o){t instanceof Array&&(t=t.join("|"));var i=RegExp(t,"gi");return o.match(i)},Cloudvisio.prototype.keys=function(t){t=t||this.data();var o=[];for(var i in t){var n=Object.keys(t[i]);for(var r in n)o.indexOf(n[r])>-1||o.push(n[r])}return o},Cloudvisio.prototype.axis=function(t){if(!arguments.length)return Object.keys(this.models[0]);var o=this.data();for(var i in o)this.models[i]===void 0&&(this.models[i]={}),this.models[i][t]="string"==typeof o[i][t]?o[i][t]:"object"==typeof o[i][t]?o[i][t].value||o[i][t].name||o[i][t].title||o[i][t].id||o[i][t]:null;return this},Cloudvisio.prototype.group=function(t,o){for(var i in this.models){var n=this.models[i];if(n[o]!==void 0){var r=this.find(t,n[o]);n["group_"+o]=r}else n["group_"+o]=null}},Cloudvisio.prototype._data={},Cloudvisio.prototype.process=function(t,o){console.log(t+" : "+o)},Cloudvisio.prototype.match=function(t){return RegExp(t),this},Cloudvisio.prototype.verbalize=function(){},Cloudvisio.prototype.chart=function(t){return arguments.length?(this._chart=t,this.charts[this.options.layout]===void 0&&(this.charts[this.options.layout]=t),this):this._chart},Cloudvisio.prototype.charts={},Cloudvisio.prototype.charts.stack=function(){var o=this,i=960,n=500,r="country",e="population",s=this.models.map(function(t){return t[r]}),a=this.models.map(function(t,o){return{x:o,y:t[e]}}),l=[a],u=t.select(this.el+" "+this.options.container).append("svg:g").attr("transform","translate(30,470)");x=t.scale.ordinal().rangeRoundBands([0,i]),y=t.scale.linear().range([0,n]);var c=t.layout.stack()(l);x.domain(c[0].map(function(t){return t.x})),y.domain([0,t.max(c[c.length-1],function(t){return t.y0+t.y})]);var p=u.selectAll("g.valgroup").data(c).enter().append("svg:g").attr("class","valgroup").style("fill",function(t,i){return o.color(i)}).style("stroke",function(i,n){return t.rgb(o.color(n)).darker()});p.selectAll("rect").data(function(t){return t}).enter().append("svg:rect").attr("x",function(t){return x(t.x)}).attr("y",function(t){return-y(t.y0)-y(t.y)}).attr("height",function(t){return y(t.y)}).attr("width",x.rangeBand()),u.selectAll("text").data(s).enter().append("svg:text").attr("x",function(t){return x(t)+x.rangeBand()/2}).attr("y",6).attr("text-anchor","middle").attr("dy",".71em").text(function(t){return t});var h=u.selectAll("g.rule").data(y.ticks(5)).enter().append("svg:g").attr("class","rule").attr("transform",function(t){return"translate(0,"+-y(t)+")"});h.append("svg:line").attr("x2",i).style("stroke",function(t){return t?"#fff":"#000"}).style("stroke-opacity",function(t){return t?.3:null}),h.append("svg:text").attr("x",-20).attr("dy",".35em").text(t.format(",d"))};var n=t.svg.arc();Cloudvisio.prototype.charts.pie=function(){var i=this,r=300,e=0,s="country",a="population";this.models.map(function(t){return t[s]});var l=this.models.map(function(t){return t[a]}),u=[l],c=t.select(this.el+" "+this.options.container).data(u).append("svg:g").attr("transform","translate("+r+","+r+")");c.selectAll("path").data(t.layout.pie()).enter().append("svg:path").attr("class","slice").attr("d",n.innerRadius(e).outerRadius(r)).style("fill",function(t,o){return i.color(o)}),c.selectAll("path").transition().ease("cubic").duration(2e3).attrTween("d",o)},Cloudvisio.prototype.render=function(){t.select(this.el+" "+this.options.container).data(this.models);var o=this.chart();o.call(this,arguments)},Cloudvisio.prototype.update=function(){},Cloudvisio.prototype.set=function(t){if(!(t instanceof Object))return this;for(var o in t)this.options[o]=t[o];return this},Cloudvisio.prototype._container=function(){t.select(this.el).append(this.options.container).attr("width",this.options.width).attr("height",this.options.height)},Cloudvisio.prototype.colors=function(t){return arguments.length?(this.options.colors=t,this):this.options.colors},Cloudvisio.prototype.color=function(t){return this.options.colors instanceof Function?this.options.colors(t):this.options.colors[t]}}(window.d3);